FROM darthsim/imgproxy:latest

# تنظیمات محیطی
ENV IMGPROXY_NETWORK="tcp" \
    IMGPROXY_BIND=":8080" \
    IMGPROXY_LOG_LEVEL="warn" \
    IMGPROXY_LOG_FORMAT="pretty" \
    IMGPROXY_DEVELOPMENT_ERRORS_MODE=false \
    IMGPROXY_ENABLE_DEBUG_HEADERS=false \
    IMGPROXY_READ_REQUEST_TIMEOUT=10 \
    IMGPROXY_TIMEOUT=10 \
    IMGPROXY_KEEP_ALIVE_TIMEOUT=10 \
    IMGPROXY_CLIENT_KEEP_ALIVE_TIMEOUT=90 \
    IMGPROXY_DOWNLOAD_TIMEOUT=10 \
    IMGPROXY_BASE_URL="https://i.dubz.ir" \
    # تنظیمات امنیتی
    IMGPROXY_ALLOWED_SOURCES="*" \
    IMGPROXY_ALLOW_PRIVATE_SOURCE_ADDRESSES=true \
    IMGPROXY_IGNORE_SSL_VERIFICATION=true \
    IMGPROXY_MAX_SRC_FILE_SIZE=10485760 \
    IMGPROXY_MAX_SRC_RESOLUTION=50 \
    # تنظیمات کیفیت
    IMGPROXY_QUALITY=80 \
    IMGPROXY_FORMAT_QUALITY="jpeg=80,webp=70,avif=50" \
    IMGPROXY_JPEG_PROGRESSIVE=false \
    IMGPROXY_PNG_INTERLACED=false \
    IMGPROXY_PNG_QUANTIZATION_COLORS=256 \
    IMGPROXY_PNG_QUANTIZE=false \
    # تنظیمات کش
    IMGPROXY_TTL=31536000 \
    IMGPROXY_CACHE_CONTROL_PASSTHROUGH=true \
    # تنظیمات فرمت
    IMGPROXY_PREFERRED_FORMATS="jpeg,png,gif" \
    IMGPROXY_SKIP_PROCESSING_FORMATS="svg,webp,avif" \
    # تنظیمات پردازش
    IMGPROXY_AUTO_ROTATE=true \
    IMGPROXY_DISABLE_SHRINK_ON_LOAD=false \
    IMGPROXY_ENFORCE_THUMBNAIL=false \
    IMGPROXY_KEEP_COPYRIGHT=false \
    IMGPROXY_RETURN_ATTACHMENT=false \
    IMGPROXY_SANITIZE_SVG=true \
    IMGPROXY_STRIP_COLOR_PROFILE=true \
    IMGPROXY_STRIP_METADATA=true \
    IMGPROXY_SVG_FIX_UNSUPPORTED=false \
    IMGPROXY_USE_LINEAR_COLORSPACE=false

# پورت‌های مورد نیاز
EXPOSE 8080

# دستور اجرا
CMD ["imgproxy"]