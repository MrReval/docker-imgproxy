FROM darthsim/imgproxy:latest

# تنظیمات محیطی
ENV IMGPROXY_NETWORK="tcp" \
    IMGPROXY_BIND=":8080" \
    IMGPROXY_LOG_LEVEL="warn" \
    IMGPROXY_LOG_FORMAT="pretty" \
    IMGPROXY_DEVELOPMENT_ERRORS_MODE=false \
    IMGPROXY_ENABLE_DEBUG_HEADERS=false \
    IMGPROXY_READ_REQUEST_TIMEOUT=10 \
    IMGPROXY_TIMEOUT=10 \
    IMGPROXY_KEEP_ALIVE_TIMEOUT=10 \
    IMGPROXY_CLIENT_KEEP_ALIVE_TIMEOUT=90 \
    IMGPROXY_DOWNLOAD_TIMEOUT=10 \
    IMGPROXY_BASE_URL="https://i.dubz.ir" \
    IMGPROXY_QUALITY=80 \
    IMGPROXY_FORMAT_QUALITY="jpeg=80,webp=70,avif=50" \
    IMGPROXY_JPEG_PROGRESSIVE=false \
    IMGPROXY_PNG_INTERLACED=false \
    IMGPROXY_PNG_QUANTIZATION_COLORS=256 \
    IMGPROXY_PNG_QUANTIZE=false \
    IMGPROXY_AVIF_SPEED=9 \
    IMGPROXY_ENABLE_AVIF_DETECTION=false \
    IMGPROXY_ENFORCE_AVIF=false \
    IMGPROXY_ENABLE_WEBP_DETECTION=false \
    IMGPROXY_ENFORCE_WEBP=false \
    IMGPROXY_PREFERRED_FORMATS="jpeg,png,gif" \
    IMGPROXY_SKIP_PROCESSING_FORMATS="svg,webp,avif" \
    IMGPROXY_ENABLE_CLIENT_HINTS=true \
    IMGPROXY_AUTO_ROTATE=true \
    IMGPROXY_DISABLE_SHRINK_ON_LOAD=false \
    IMGPROXY_ENFORCE_THUMBNAIL=false \
    IMGPROXY_KEEP_COPYRIGHT=false \
    IMGPROXY_RETURN_ATTACHMENT=false \
    IMGPROXY_SANITIZE_SVG=true \
    IMGPROXY_STRIP_COLOR_PROFILE=true \
    IMGPROXY_STRIP_METADATA=true \
    IMGPROXY_SVG_FIX_UNSUPPORTED=false \
    IMGPROXY_USE_LINEAR_COLORSPACE=false

# پورت‌های مورد نیاز
EXPOSE 8080

# دستور اجرا
CMD ["imgproxy"]